<div class="bg-slate-800 rounded-2xl p-6">

    <h3 class="text-xl font-semibold text-amber-400 mb-4">{{ lang.t().ma_single_title }}</h3>

    <!-- ANALYZE BUTTON -->
    @if (!report() && !isLoading()) {
        <button
                (click)="analyze()"
                class="w-full py-3 bg-amber-500 hover:bg-amber-600 text-slate-900 font-bold rounded-xl transition-all">
            {{ lang.t().btn_analyze_menu }}
        </button>
    }

    <!-- LOADING -->
    @if (isLoading()) {
        <div class="text-center py-8">
            <div class="animate-spin w-12 h-12 border-4 border-amber-500 border-t-transparent rounded-full mx-auto mb-4"></div>
            <p class="text-slate-400">{{ lang.t().ma_single_calculating }}</p>
        </div>
    }

    <!-- ERROR -->
    @if (error()) {
        <div class="bg-red-500/20 text-red-400 p-4 rounded-xl">
            {{ error() }}
        </div>
    }

    <!-- REPORT -->
    @if (report(); as r) {
        <div class="space-y-6">

            <!-- SUMMARY CARDS -->
            <div class="grid grid-cols-3 gap-4">
                <div class="bg-slate-700/50 p-4 rounded-xl text-center">
                    <p class="text-2xl font-bold text-red-400">€{{ r.total_food_cost.toFixed(2) }}</p>
                    <p class="text-sm text-slate-400">{{ lang.t().market_total_cost }}</p>
                </div>
                <div class="bg-slate-700/50 p-4 rounded-xl text-center">
                    <p class="text-2xl font-bold text-green-400">€{{ r.suggested_menu_price.toFixed(2) }}</p>
                    <p class="text-sm text-slate-400">{{ lang.t().market_sugg_price }}</p>
                </div>
                <div class="bg-slate-700/50 p-4 rounded-xl text-center">
                    <p class="text-2xl font-bold text-amber-400">{{ r.profit_margin_percentage }}%</p>
                    <p class="text-sm text-slate-400">{{ lang.t().market_margin }}</p>
                </div>
            </div>

            <!-- COST BREAKDOWN TABLE -->
            <div>
                <h4 class="text-lg font-semibold text-amber-400 mb-3">Cost Breakdown</h4>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                        <tr class="border-b border-slate-700">
                            <th class="text-left py-2 text-slate-400">{{ lang.t().col_ingredient }}</th>
                            <th class="text-left py-2 text-slate-400">{{ lang.t().col_qty }}</th>
                            <th class="text-left py-2 text-slate-400">{{ lang.t().col_price }}</th>
                            <th class="text-right py-2 text-slate-400">{{ lang.t().col_cost }}</th>
                            <th class="text-center py-2 text-slate-400">{{ lang.t().col_trend }}</th>
                        </tr>
                        </thead>
                        <tbody>
                            @for (item of r.cost_breakdown; track item.ingredient) {
                                <tr class="border-b border-slate-700/50">
                                    <td class="py-2 text-white">{{ item.ingredient }}</td>
                                    <td class="py-2 text-slate-300">{{ item.quantity_used }}</td>
                                    <td class="py-2 text-slate-300">{{ item.market_unit_price }}</td>
                                    <td class="py-2 text-right text-amber-400">€{{ item.calculated_cost.toFixed(2) }}</td>
                                    <td class="py-2 text-center">{{ getTrendIcon(item.market_trend) }}</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }
</div>
<div class="bg-slate-800 rounded-2xl p-6">

    <!-- HEADER -->
    <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-amber-400">{{ lang.t().menu_ws_title }}</h2>
        <div class="flex gap-2">
            @if (menuHistory().length) {
                <button
                        (click)="undo()"
                        class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-sm">
                    {{ lang.t().btn_undo_last }}
                </button>
            }
            <button
                    (click)="analyzeMarket()"
                    [disabled]="isAnalyzing()"
                    class="px-4 py-2 bg-amber-500 hover:bg-amber-600 text-slate-900 rounded-lg text-sm font-medium">
                {{ lang.t().btn_analyze_menu }}
            </button>
        </div>
    </div>

    <!-- CONCEPT -->
    <div class="bg-gradient-to-r from-amber-900/30 to-slate-800 p-6 rounded-xl mb-6">
        <h3 class="text-xl font-semibold text-amber-400 mb-2">{{ menu.concept.title }}</h3>
        <p class="text-slate-300 mb-4">{{ menu.concept.description }}</p>
        <div class="flex gap-4 text-sm text-slate-400">
            <span>üçÇ {{ menu.concept.seasonality }}</span>
            <span>üí≠ {{ menu.concept.philosophical_theme }}</span>
        </div>
    </div>

    <!-- COURSE LIST or DETAIL VIEW -->
    @if (selectedCourseIndex() === null) {

        <!-- COURSES GRID -->
        <div class="mb-6">
            <h3 class="text-lg font-semibold text-slate-300 mb-4">{{ lang.t().menu_ws_courses }} ({{ menu.courses.length }})</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                @for (course of menu.courses; track course.meta.dish_name; let i = $index) {
                    <div class="bg-slate-700/50 rounded-xl p-4 hover:bg-slate-700 transition-all">
                        <div class="flex items-start justify-between mb-2">
              <span class="bg-amber-500 text-slate-900 w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm">
                {{ i + 1 }}
              </span>
                            <span class="text-xs text-slate-400">{{ course.meta.dish_category }}</span>
                        </div>
                        <h4 class="font-semibold text-white mb-1">{{ course.meta.dish_name }}</h4>
                        <p class="text-slate-400 text-sm mb-3 line-clamp-2">{{ course.meta.concept_summary }}</p>
                        <div class="flex gap-2">
                            <button
                                    (click)="viewCourse(i)"
                                    class="flex-1 px-3 py-2 bg-amber-500 hover:bg-amber-600 text-slate-900 rounded-lg text-sm font-medium">
                                {{ lang.t().btn_view_course }}
                            </button>
                            <button
                                    (click)="regenerateCourse(i)"
                                    [disabled]="isUpdating()"
                                    class="px-3 py-2 bg-slate-600 hover:bg-slate-500 text-white rounded-lg text-sm">
                                üîÑ
                            </button>
                        </div>
                    </div>
                }
            </div>
        </div>

    } @else {

        <!-- COURSE DETAIL -->
        <div class="mb-6">
            <button
                    (click)="backToMenu()"
                    class="mb-4 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-sm">
                ‚Üê {{ lang.t().btn_back_to_menu }}
            </button>

            @if (selectedCourse; as course) {
                <div class="bg-slate-700/30 rounded-xl p-6">
                    <h3 class="text-2xl font-bold text-amber-400 mb-2">{{ course.meta.dish_name }}</h3>
                    <p class="text-slate-400 mb-4">{{ course.meta.concept_summary }}</p>

                    <div class="space-y-4">
                        <div>
                            <h4 class="text-lg font-semibold text-amber-400 mb-2">Ingredienti</h4>
                            <ul class="grid grid-cols-2 gap-2">
                                @for (ing of course.maestro_synthesis.ingredients; track ing.name) {
                                    <li class="text-slate-300">{{ ing.name }} - {{ ing.quantity }}</li>
                                }
                            </ul>
                        </div>
                    </div>
                </div>
            }
        </div>

    }

    <!-- MARKET REPORT MODAL/SECTION -->
    @if (marketReport(); as report) {
        <div class="mt-6 bg-gradient-to-r from-green-900/30 to-slate-800 p-6 rounded-xl">
            <h3 class="text-xl font-semibold text-green-400 mb-4">{{ lang.t().ma_report_title }}</h3>
            <div class="grid grid-cols-3 gap-4 mb-4">
                <div class="text-center">
                    <p class="text-2xl font-bold text-red-400">‚Ç¨{{ report.overall_food_cost.toFixed(2) }}</p>
                    <p class="text-sm text-slate-400">{{ lang.t().ma_total_cost }}</p>
                </div>
                <div class="text-center">
                    <p class="text-2xl font-bold text-green-400">‚Ç¨{{ report.recommended_price_per_pax.toFixed(2) }}</p>
                    <p class="text-sm text-slate-400">{{ lang.t().ma_rec_price }}</p>
                </div>
                <div class="text-center">
                    <p class="text-2xl font-bold text-amber-400">{{ report.target_margin }}%</p>
                    <p class="text-sm text-slate-400">{{ lang.t().ma_margin }}</p>
                </div>
            </div>
            <p class="text-slate-300">{{ report.financial_narrative }}</p>
        </div>
    }
</div>